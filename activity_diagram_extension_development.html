<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Symphony IDE - Activity Diagram: Extension Development Workflow</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }
    
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
      background: #f5f5f5;
      padding: 2rem;
      overflow: auto;
    }
    
    .container {
      width: 100%;
      max-width: 100%;
      background: white;
      border-radius: 12px;
      box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
      padding: 2rem;
    }
    
    .header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 2rem;
      padding-bottom: 1rem;
      border-bottom: 2px solid #e5e7eb;
    }
    
    h1 {
      font-size: 1.75rem;
      font-weight: bold;
      color: #111827;
    }
    
    .buttons {
      display: flex;
      gap: 0.75rem;
    }
    
    button {
      padding: 0.625rem 1.25rem;
      background: linear-gradient(135deg, #333333 0%, #1a1a1a 100%);
      color: white;
      border: none;
      border-radius: 0.5rem;
      cursor: pointer;
      font-size: 0.875rem;
      font-weight: 600;
      transition: all 0.2s;
      box-shadow: 0 2px 4px rgba(0, 0, 0, 0.3);
    }
    
    button:hover {
      background: linear-gradient(135deg, #1a1a1a 0%, #000000 100%);
      transform: translateY(-1px);
      box-shadow: 0 4px 8px rgba(0, 0, 0, 0.4);
    }
    
    .diagram-wrapper {
      background: white;
      border-radius: 8px;
      border: 2px solid #d1d5db;
      padding: 1rem;
      overflow-x: auto;
    }
    
    svg {
      width: 100%;
      height: auto;
      min-width: 100%;
      border: 1px solid #e5e7eb;
      border-radius: 4px;
    }
  </style>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
</head>
<body>
  <div class="container">
    <div class="header">
      <h1>Symphony IDE - Activity Diagram: Extension Development Workflow (Carets CLI)</h1>
      <div class="buttons">
        <button onclick="saveToPNG()">ðŸ’¾ Save as PNG</button>
        <button onclick="saveToPDF()">ðŸ“„ Save as PDF</button>
      </div>
    </div>
    
    <div class="diagram-wrapper">
      <svg id="diagram" viewBox="0 0 1400 1950" xmlns="http://www.w3.org/2000/svg">
        <defs>
          <marker id="arrowhead" markerWidth="10" markerHeight="10" refX="9" refY="3" orient="auto">
            <polygon points="0 0, 10 3, 0 6" fill="#1f2937" />
          </marker>
          
          <marker id="arrowhead-dashed" markerWidth="10" markerHeight="10" refX="9" refY="3" orient="auto">
            <polygon points="0 0, 10 3, 0 6" fill="#6b7280" />
          </marker>

          <filter id="shadow" x="-50%" y="-50%" width="200%" height="200%">
            <feGaussianBlur in="SourceAlpha" stdDeviation="2"/>
            <feOffset dx="2" dy="2" result="offsetblur"/>
            <feComponentTransfer>
              <feFuncA type="linear" slope="0.15"/>
            </feComponentTransfer>
            <feMerge>
              <feMergeNode/>
              <feMergeNode in="SourceGraphic"/>
            </feMerge>
          </filter>
        </defs>
        
        <!-- Swimlanes -->
        <rect x="50" y="80" width="400" height="1800" fill="#f0f9ff" stroke="#4a90e2" stroke-width="2" stroke-dasharray="8,4"/>
        <text x="250" y="70" text-anchor="middle" font-size="16" font-weight="bold" fill="#1f2937">Extension Creator</text>
        
        <rect x="450" y="80" width="400" height="1800" fill="#fef3c7" stroke="#f59e0b" stroke-width="2" stroke-dasharray="8,4"/>
        <text x="650" y="70" text-anchor="middle" font-size="16" font-weight="bold" fill="#1f2937">Carets CLI & SDK</text>
        
        <rect x="850" y="80" width="500" height="1800" fill="#e8f4f8" stroke="#4a90e2" stroke-width="2" stroke-dasharray="8,4"/>
        <text x="1100" y="70" text-anchor="middle" font-size="16" font-weight="bold" fill="#1f2937">Grand Stage & Polyphony</text>
        
        <!-- Initial Node -->
        <circle cx="250" cy="130" r="15" fill="#1f2937" filter="url(#shadow)"/>
        <text x="285" y="135" font-size="11" font-style="italic" fill="#6b7280">&lt;&lt;start&gt;&gt;</text>
        
        <!-- Action: Run carets new -->
        <rect x="160" y="180" width="180" height="60" rx="15" fill="#ffffff" stroke="#4a90e2" stroke-width="2" filter="url(#shadow)"/>
        <text x="250" y="208" text-anchor="middle" font-size="14" font-weight="500" fill="#1f2937">Run: carets new</text>
        <text x="250" y="223" text-anchor="middle" font-size="11" fill="#6b7280">(my-instrument)</text>
        
        <path d="M 250 145 L 250 180" stroke="#1f2937" stroke-width="2" fill="none" marker-end="url(#arrowhead)"/>
        
        <!-- Object Flow -->
        <path d="M 250 240 L 650 290" stroke="#6b7280" stroke-width="2" stroke-dasharray="4,3" fill="none" marker-end="url(#arrowhead-dashed)"/>
        <text x="430" y="260" font-size="11" font-style="italic" fill="#6b7280">{extension name}</text>
        
        <!-- Action: Generate Template -->
        <rect x="560" y="290" width="180" height="60" rx="15" fill="#ffffff" stroke="#f59e0b" stroke-width="2" filter="url(#shadow)"/>
        <text x="650" y="318" text-anchor="middle" font-size="14" font-weight="500" fill="#1f2937">Generate Template</text>
        <text x="650" y="333" text-anchor="middle" font-size="11" fill="#6b7280">(Scaffold Structure)</text>
        
        <!-- Action: Create Manifest -->
        <rect x="560" y="380" width="180" height="60" rx="15" fill="#ffffff" stroke="#f59e0b" stroke-width="2" filter="url(#shadow)"/>
        <text x="650" y="408" text-anchor="middle" font-size="14" font-weight="500" fill="#1f2937">Create Manifest</text>
        <text x="650" y="423" text-anchor="middle" font-size="11" fill="#6b7280">(Symphony.toml)</text>
        
        <path d="M 650 350 L 650 380" stroke="#1f2937" stroke-width="2" fill="none" marker-end="url(#arrowhead)"/>
        
        <!-- Action: Develop Extension -->
        <rect x="160" y="470" width="180" height="60" rx="15" fill="#ffffff" stroke="#4a90e2" stroke-width="2" filter="url(#shadow)"/>
        <text x="250" y="498" text-anchor="middle" font-size="14" font-weight="500" fill="#1f2937">Develop Extension</text>
        <text x="250" y="513" text-anchor="middle" font-size="11" fill="#6b7280">(Write Code)</text>
        
        <path d="M 650 440 L 650 500 L 340 500" stroke="#1f2937" stroke-width="2" fill="none" marker-end="url(#arrowhead)"/>
        
        <!-- Action: Run carets test -->
        <rect x="160" y="560" width="180" height="60" rx="15" fill="#ffffff" stroke="#4a90e2" stroke-width="2" filter="url(#shadow)"/>
        <text x="250" y="595" text-anchor="middle" font-size="14" font-weight="500" fill="#1f2937">Run: carets test</text>
        
        <path d="M 250 530 L 250 560" stroke="#1f2937" stroke-width="2" fill="none" marker-end="url(#arrowhead)"/>
        
        <!-- Object Flow -->
        <path d="M 250 620 L 650 670" stroke="#6b7280" stroke-width="2" stroke-dasharray="4,3" fill="none" marker-end="url(#arrowhead-dashed)"/>
        <text x="430" y="640" font-size="11" font-style="italic" fill="#6b7280">{test request}</text>
        
        <!-- Action: Run Test Suite -->
        <rect x="560" y="670" width="180" height="60" rx="15" fill="#ffffff" stroke="#f59e0b" stroke-width="2" filter="url(#shadow)"/>
        <text x="650" y="698" text-anchor="middle" font-size="14" font-weight="500" fill="#1f2937">Run Test Suite</text>
        <text x="650" y="713" text-anchor="middle" font-size="11" fill="#6b7280">(Unit + Integration)</text>
        
        <!-- Decision: Tests Pass? -->
        <path d="M 650 760 L 700 810 L 650 860 L 600 810 Z" fill="#fef3c7" stroke="#f59e0b" stroke-width="2" filter="url(#shadow)"/>
        <text x="650" y="815" text-anchor="middle" font-size="13" font-weight="600" fill="#1f2937">Pass?</text>
        
        <path d="M 650 730 L 650 760" stroke="#1f2937" stroke-width="2" fill="none" marker-end="url(#arrowhead)"/>
        
        <!-- Guard: [Failed] -->
        <path d="M 600 810 L 250 810 L 250 470" stroke="#ef4444" stroke-width="2" fill="none" marker-end="url(#arrowhead)"/>
        <text x="420" y="800" font-size="12" font-style="italic" fill="#ef4444" font-weight="600">[failed]</text>
        
        <!-- Guard: [Passed] -->
        <path d="M 650 860 L 650 920" stroke="#10b981" stroke-width="2" fill="none" marker-end="url(#arrowhead)"/>
        <text x="665" y="890" font-size="12" font-style="italic" fill="#10b981" font-weight="600">[passed]</text>
        
        <!-- Action: Run carets publish -->
        <rect x="160" y="920" width="180" height="60" rx="15" fill="#ffffff" stroke="#4a90e2" stroke-width="2" filter="url(#shadow)"/>
        <text x="250" y="955" text-anchor="middle" font-size="14" font-weight="500" fill="#1f2937">Run: carets publish</text>
        
        <path d="M 650 920 L 650 950 L 340 950" stroke="#1f2937" stroke-width="2" fill="none" marker-end="url(#arrowhead)"/>
        
        <!-- Object Flow -->
        <path d="M 250 980 L 650 1030" stroke="#6b7280" stroke-width="2" stroke-dasharray="4,3" fill="none" marker-end="url(#arrowhead-dashed)"/>
        <text x="430" y="1000" font-size="11" font-style="italic" fill="#6b7280">{extension package}</text>
        
        <!-- Action: Validate Manifest -->
        <rect x="560" y="1030" width="180" height="60" rx="15" fill="#ffffff" stroke="#f59e0b" stroke-width="2" filter="url(#shadow)"/>
        <text x="650" y="1058" text-anchor="middle" font-size="14" font-weight="500" fill="#1f2937">Validate Manifest</text>
        <text x="650" y="1073" text-anchor="middle" font-size="11" fill="#6b7280">(Check Dependencies)</text>
        
        <!-- Action: Sign Package -->
        <rect x="560" y="1120" width="180" height="60" rx="15" fill="#ffffff" stroke="#f59e0b" stroke-width="2" filter="url(#shadow)"/>
        <text x="650" y="1155" text-anchor="middle" font-size="14" font-weight="500" fill="#1f2937">Sign Package</text>
        
        <path d="M 650 1090 L 650 1120" stroke="#1f2937" stroke-width="2" fill="none" marker-end="url(#arrowhead)"/>
        
        <!-- Object Flow to Grand Stage -->
        <path d="M 740 1150 L 1100 1200" stroke="#6b7280" stroke-width="2" stroke-dasharray="4,3" fill="none" marker-end="url(#arrowhead-dashed)"/>
        <text x="900" y="1170" font-size="11" font-style="italic" fill="#6b7280">{signed package}</text>
        
        <!-- Action: Upload to Grand Stage -->
        <rect x="1010" y="1200" width="180" height="60" rx="15" fill="#ffffff" stroke="#4a90e2" stroke-width="2" filter="url(#shadow)"/>
        <text x="1100" y="1228" text-anchor="middle" font-size="14" font-weight="500" fill="#1f2937">Upload to Grand Stage</text>
        <text x="1100" y="1243" text-anchor="middle" font-size="11" fill="#6b7280">(Marketplace)</text>
        
        <!-- Action: Register in Registry -->
        <rect x="1010" y="1290" width="180" height="60" rx="15" fill="#ffffff" stroke="#4a90e2" stroke-width="2" filter="url(#shadow)"/>
        <text x="1100" y="1318" text-anchor="middle" font-size="14" font-weight="500" fill="#1f2937">Register in Registry</text>
        <text x="1100" y="1333" text-anchor="middle" font-size="11" fill="#6b7280">(Semantic Version)</text>
        
        <path d="M 1100 1260 L 1100 1290" stroke="#1f2937" stroke-width="2" fill="none" marker-end="url(#arrowhead)"/>
        
        <!-- Action: Index for Search -->
        <rect x="1010" y="1380" width="180" height="60" rx="15" fill="#ffffff" stroke="#4a90e2" stroke-width="2" filter="url(#shadow)"/>
        <text x="1100" y="1415" text-anchor="middle" font-size="14" font-weight="500" fill="#1f2937">Index for Search</text>
        
        <path d="M 1100 1350 L 1100 1380" stroke="#1f2937" stroke-width="2" fill="none" marker-end="url(#arrowhead)"/>
        
        <!-- Polyphony Lifecycle Section -->
        <rect x="870" y="1470" width="460" height="70" rx="10" fill="#dcfce7" stroke="#16a34a" stroke-width="3" filter="url(#shadow)"/>
        <text x="1100" y="1495" text-anchor="middle" font-size="15" font-weight="bold" fill="#16a34a">POLYPHONY LIFECYCLE</text>
        <text x="1100" y="1515" text-anchor="middle" font-size="12" fill="#1f2937">Extension Monitoring & Analytics</text>
        <text x="1100" y="1530" text-anchor="middle" font-size="11" fill="#6b7280">(Downloads, Ratings, Reviews)</text>
        
        <path d="M 1100 1440 L 1100 1470" stroke="#1f2937" stroke-width="2" fill="none" marker-end="url(#arrowhead)"/>
        
        <!-- Fork: Parallel Monitoring -->
        <rect x="1050" y="1570" width="100" height="8" rx="2" fill="#1f2937" filter="url(#shadow)"/>
        
        <path d="M 1100 1540 L 1100 1570" stroke="#1f2937" stroke-width="2" fill="none" marker-end="url(#arrowhead)"/>
        
        <!-- Parallel: Track Downloads -->
        <rect x="920" y="1610" width="160" height="50" rx="12" fill="#ffffff" stroke="#10b981" stroke-width="2" filter="url(#shadow)"/>
        <text x="1000" y="1640" text-anchor="middle" font-size="12" font-weight="500" fill="#1f2937">Track Downloads</text>
        
        <!-- Parallel: Collect Ratings -->
        <rect x="1090" y="1610" width="160" height="50" rx="12" fill="#ffffff" stroke="#10b981" stroke-width="2" filter="url(#shadow)"/>
        <text x="1170" y="1640" text-anchor="middle" font-size="12" font-weight="500" fill="#1f2937">Collect Ratings</text>
        
        <!-- Parallel: Monitor Reviews -->
        <rect x="1005" y="1690" width="160" height="50" rx="12" fill="#ffffff" stroke="#10b981" stroke-width="2" filter="url(#shadow)"/>
        <text x="1085" y="1720" text-anchor="middle" font-size="12" font-weight="500" fill="#1f2937">Monitor Reviews</text>
        
        <path d="M 1100 1578 L 1000 1610" stroke="#1f2937" stroke-width="2" fill="none" marker-end="url(#arrowhead)"/>
        <path d="M 1100 1578 L 1170 1610" stroke="#1f2937" stroke-width="2" fill="none" marker-end="url(#arrowhead)"/>
        <path d="M 1100 1578 L 1085 1690" stroke="#1f2937" stroke-width="2" fill="none" marker-end="url(#arrowhead)"/>
        
        <!-- Action: View Analytics -->
        <rect x="160" y="1650" width="180" height="60" rx="15" fill="#ffffff" stroke="#4a90e2" stroke-width="2" filter="url(#shadow)"/>
        <text x="250" y="1685" text-anchor="middle" font-size="14" font-weight="500" fill="#1f2937">View Analytics</text>
        
        <path d="M 1100 1578 L 250 1680" stroke="#1f2937" stroke-width="2" fill="none" marker-end="url(#arrowhead)"/>
        
        <!-- Decision: Update Extension? -->
        <path d="M 250 1740 L 300 1790 L 250 1840 L 200 1790 Z" fill="#f0f9ff" stroke="#4a90e2" stroke-width="2" filter="url(#shadow)"/>
        <text x="250" y="1788" text-anchor="middle" font-size="13" font-weight="600" fill="#1f2937">Update</text>
        <text x="250" y="1803" text-anchor="middle" font-size="11" fill="#6b7280">Needed?</text>
        
        <path d="M 250 1710 L 250 1740" stroke="#1f2937" stroke-width="2" fill="none" marker-end="url(#arrowhead)"/>
        
        <!-- Guard: [Yes] - loop back -->
        <path d="M 200 1790 L 80 1790 L 80 500 L 160 500" stroke="#10b981" stroke-width="2" fill="none" marker-end="url(#arrowhead)"/>
        <text x="90" y="1140" font-size="12" font-style="italic" fill="#10b981" font-weight="600">[yes]</text>
        
        <!-- Guard: [No] - end -->
        <path d="M 300 1790 L 1100 1790 L 1100 1820" stroke="#4a90e2" stroke-width="2" fill="none" marker-end="url(#arrowhead)"/>
        <text x="650" y="1780" font-size="12" font-style="italic" fill="#4a90e2" font-weight="600">[no]</text>
        
        <!-- Final Node -->
        <circle cx="1100" cy="1830" r="15" fill="#ffffff" stroke="#1f2937" stroke-width="3" filter="url(#shadow)"/>
        <circle cx="1100" cy="1830" r="10" fill="#1f2937"/>
        <text x="1135" y="1835" font-size="11" font-style="italic" fill="#6b7280">&lt;&lt;complete&gt;&gt;</text>
      </svg>
    </div>
  </div>

  <script>
    async function saveToPNG() {
      const svg = document.getElementById('diagram');
      
      try {
        const viewBox = svg.getAttribute('viewBox').split(' ');
        const svgWidth = parseFloat(viewBox[2]);
        const svgHeight = parseFloat(viewBox[3]);
        
        const tempContainer = document.createElement('div');
        tempContainer.style.position = 'absolute';
        tempContainer.style.left = '-9999px';
        tempContainer.style.width = svgWidth + 'px';
        tempContainer.style.height = svgHeight + 'px';
        tempContainer.style.padding = '20px';
        tempContainer.style.backgroundColor = '#ffffff';
        
        const svgClone = svg.cloneNode(true);
        svgClone.setAttribute('width', svgWidth);
        svgClone.setAttribute('height', svgHeight);
        tempContainer.appendChild(svgClone);
        document.body.appendChild(tempContainer);
        
        const canvas = await html2canvas(tempContainer, {
          scale: 3,
          backgroundColor: '#ffffff',
          logging: false,
          useCORS: true,
          allowTaint: true,
          width: svgWidth + 40,
          height: svgHeight + 40
        });
        
        document.body.removeChild(tempContainer);
        
        canvas.toBlob(function(blob) {
          const link = document.createElement('a');
          link.href = URL.createObjectURL(blob);
          link.download = 'symphony-extension-development.png';
          link.click();
          URL.revokeObjectURL(link.href);
        }, 'image/png', 1.0);
        
      } catch (error) {
        console.error('Error generating PNG:', error);
        alert('Error generating PNG. Please try again.');
      }
    }

    function saveToPDF() {
      window.print();
    }
  </script>
  
  <style media="print">
    body {
      padding: 0;
      margin: 0;
    }
    .buttons {
      display: none;
    }
    .container {
      box-shadow: none;
      max-width: 100%;
    }
  </style>
</body>
</html>
