# Cargo Make configuration for Symphony Backend
# Provides convenient task automation

[config]
default_to_workspace = false
skip_core_tasks = false

[env]
CARGO_MAKE_EXTEND_WORKSPACE_MAKEFILE = true
RUST_BACKTRACE = "1"

# Format all code
[tasks.fmt]
description = "Format all Rust code using rustfmt"
command = "cargo"
args = ["fmt", "--all"]

# Check formatting without making changes
[tasks.fmt-check]
description = "Check if code is formatted correctly"
command = "cargo"
args = ["fmt", "--all", "--", "--check"]

# Run clippy with strict settings
[tasks.lint]
description = "Run clippy with strict linting rules"
command = "cargo"
args = ["clippy", "--all-targets", "--all-features", "--workspace", "--", "-D", "warnings"]

# Run clippy and fix issues automatically
[tasks.lint-fix]
description = "Run clippy and automatically fix issues"
command = "cargo"
args = ["clippy", "--all-targets", "--all-features", "--workspace", "--fix", "--allow-dirty", "--allow-staged"]

# Build all packages
[tasks.build]
description = "Build all packages in the workspace"
command = "cargo"
args = ["build", "--all-features", "--workspace"]

# Build in release mode
[tasks.build-release]
description = "Build all packages in release mode"
command = "cargo"
args = ["build", "--release", "--all-features", "--workspace"]

# Run all tests
[tasks.test]
description = "Run all tests in the workspace"
command = "cargo"
args = ["test", "--all-features", "--workspace"]

# Run tests with coverage
[tasks.test-coverage]
description = "Run tests with code coverage"
command = "cargo"
args = ["tarpaulin", "--all-features", "--workspace", "--out", "Html", "--output-dir", "coverage"]

# Check code without building
[tasks.check]
description = "Check code for errors without building"
command = "cargo"
args = ["check", "--all-features", "--workspace"]

# Clean build artifacts
[tasks.clean]
description = "Clean all build artifacts"
command = "cargo"
args = ["clean"]

# Audit dependencies for security vulnerabilities
[tasks.audit]
description = "Audit dependencies for security issues"
command = "cargo"
args = ["audit"]

# Check for outdated dependencies
[tasks.outdated]
description = "Check for outdated dependencies"
command = "cargo"
args = ["outdated", "--workspace"]

# Update dependencies
[tasks.update]
description = "Update dependencies to latest compatible versions"
command = "cargo"
args = ["update"]

# Run cargo deny checks
[tasks.deny]
description = "Check dependencies with cargo-deny"
command = "cargo"
args = ["deny", "check"]

# Generate documentation
[tasks.doc]
description = "Generate documentation for all packages"
command = "cargo"
args = ["doc", "--all-features", "--no-deps", "--workspace", "--open"]

# Run benchmarks
[tasks.bench]
description = "Run benchmarks"
command = "cargo"
args = ["bench", "--all-features", "--workspace"]

# Full CI pipeline
[tasks.ci]
description = "Run full CI pipeline (format check, lint, test, build)"
dependencies = [
    "fmt-check",
    "lint",
    "test",
    "build"
]

# Pre-commit checks
[tasks.pre-commit]
description = "Run pre-commit checks (format, lint, test)"
dependencies = [
    "fmt",
    "lint",
    "test"
]

# Full quality check
[tasks.quality]
description = "Run all quality checks (format, lint, audit, deny)"
dependencies = [
    "fmt-check",
    "lint",
    "audit",
    "deny"
]

# Development workflow
[tasks.dev]
description = "Run development checks (format, check, test)"
dependencies = [
    "fmt",
    "check",
    "test"
]

# Release preparation
[tasks.release-prep]
description = "Prepare for release (quality checks, build release)"
dependencies = [
    "quality",
    "test",
    "build-release"
]
