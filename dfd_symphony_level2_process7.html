<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Symphony IDE - Data Flow Diagram (Level-2: Process 7.0 Decomposition)</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }
    
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
      background: #f5f5f5;
      padding: 2rem;
      overflow: auto;
    }
    
    .container {
      width: 100%;
      max-width: 100%;
      background: white;
      border-radius: 12px;
      box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
      padding: 2rem;
    }
    
    .header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 2rem;
      padding-bottom: 1rem;
      border-bottom: 2px solid #e5e7eb;
    }
    
    h1 {
      font-size: 1.75rem;
      font-weight: bold;
      color: #111827;
    }
    
    .buttons {
      display: flex;
      gap: 0.75rem;
    }
    
    button {
      padding: 0.625rem 1.25rem;
      background: linear-gradient(135deg, #333333 0%, #1a1a1a 100%);
      color: white;
      border: none;
      border-radius: 0.5rem;
      cursor: pointer;
      font-size: 0.875rem;
      font-weight: 600;
      transition: all 0.2s;
      box-shadow: 0 2px 4px rgba(0, 0, 0, 0.3);
    }
    
    button:hover {
      background: linear-gradient(135deg, #1a1a1a 0%, #000000 100%);
      transform: translateY(-1px);
      box-shadow: 0 4px 8px rgba(0, 0, 0, 0.4);
    }
    
    .diagram-wrapper {
      background: white;
      border-radius: 8px;
      border: 2px solid #d1d5db;
      padding: 1rem;
      overflow-x: auto;
    }
    
    svg {
      width: 100%;
      height: auto;
      min-width: 100%;
      border: 1px solid #e5e7eb;
      border-radius: 4px;
    }

    .legend {
      margin-top: 1.5rem;
      padding: 1rem;
      background: #f9fafb;
      border-radius: 8px;
      border: 1px solid #e5e7eb;
    }

    .legend h3 {
      font-size: 1rem;
      font-weight: 600;
      color: #1f2937;
      margin-bottom: 0.75rem;
    }

    .legend-items {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
      gap: 0.75rem;
    }

    .legend-item {
      display: flex;
      align-items: center;
      gap: 0.5rem;
      font-size: 0.875rem;
      color: #6b7280;
    }

    .legend-shape {
      width: 40px;
      height: 24px;
      border: 2px solid #4a90e2;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 0.7rem;
      color: #1f2937;
    }

    .legend-shape.process {
      border-radius: 12px;
      background: #e0f2fe;
    }

    .legend-shape.entity {
      border-radius: 2px;
      background: #f3f4f6;
    }

    .legend-shape.datastore {
      border-left: none;
      background: white;
    }
  </style>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
</head>
<body>
  <div class="container">
    <div class="header">
      <h1>Symphony IDE - Level-2 DFD: Process 7.0 (IPC Communication) Decomposition</h1>
      <div class="buttons">
        <button onclick="saveToPNG()">ðŸ’¾ Save as PNG</button>
        <button onclick="saveToPDF()">ðŸ“„ Save as PDF</button>
      </div>
    </div>
    
    <div class="diagram-wrapper">
      <svg id="diagram" viewBox="0 0 1600 1200" xmlns="http://www.w3.org/2000/svg">
        <defs>
          <!-- Arrow marker for data flows -->
          <marker id="arrowhead" markerWidth="10" markerHeight="10" refX="9" refY="3" orient="auto">
            <polygon points="0 0, 10 3, 0 6" fill="#1f2937" />
          </marker>

          <!-- Shadow filter -->
          <filter id="shadow" x="-50%" y="-50%" width="200%" height="200%">
            <feGaussianBlur in="SourceAlpha" stdDeviation="2"/>
            <feOffset dx="2" dy="2" result="offsetblur"/>
            <feComponentTransfer>
              <feFuncA type="linear" slope="0.15"/>
            </feComponentTransfer>
            <feMerge>
              <feMergeNode/>
              <feMergeNode in="SourceGraphic"/>
            </feMerge>
          </filter>
        </defs>

        <!-- Title -->
        <text x="800" y="30" text-anchor="middle" font-size="18" font-weight="bold" fill="#1f2937">
          Level-2 DFD: Process 7.0 - IPC Communication (Message Bus)
        </text>
        <text x="800" y="55" text-anchor="middle" font-size="13" fill="#6b7280">
          Decomposition showing inter-process communication infrastructure
        </text>

        <!-- ============================================ -->
        <!-- EXTERNAL ENTITIES & ADJACENT PROCESSES -->
        <!-- ============================================ -->
        
        <!-- Process 6.0: File Operations (from Level-1) -->
        <rect x="50" y="150" width="180" height="90" rx="15" fill="#fef3c7" stroke="#f59e0b" stroke-width="2" filter="url(#shadow)"/>
        <text x="140" y="180" text-anchor="middle" font-size="11" font-weight="bold" fill="#d97706">6.0</text>
        <line x1="70" y1="192" x2="210" y2="192" stroke="#f59e0b" stroke-width="1.5"/>
        <text x="140" y="215" text-anchor="middle" font-size="13" font-weight="500" fill="#1f2937">File Operations</text>

        <!-- Process 8.0: Extension Execution (from Level-1) -->
        <rect x="1370" y="150" width="180" height="90" rx="15" fill="#dcfce7" stroke="#10b981" stroke-width="2" filter="url(#shadow)"/>
        <text x="1460" y="180" text-anchor="middle" font-size="11" font-weight="bold" fill="#059669">8.0</text>
        <line x1="1390" y1="192" x2="1530" y2="192" stroke="#10b981" stroke-width="1.5"/>
        <text x="1460" y="215" text-anchor="middle" font-size="13" font-weight="500" fill="#1f2937">Extension Execution</text>

        <!-- ============================================ -->
        <!-- SUBPROCESSES OF PROCESS 7.0 (Level-2) -->
        <!-- ============================================ -->

        <!-- Process 7.1: Message Router -->
        <rect x="350" y="350" width="220" height="120" rx="20" fill="#dcfce7" stroke="#10b981" stroke-width="2.5" filter="url(#shadow)"/>
        <text x="460" y="385" text-anchor="middle" font-size="13" font-weight="bold" fill="#059669">7.1</text>
        <line x1="375" y1="400" x2="545" y2="400" stroke="#10b981" stroke-width="2"/>
        <text x="460" y="430" text-anchor="middle" font-size="15" font-weight="600" fill="#1f2937">Message Router</text>
        <text x="460" y="450" text-anchor="middle" font-size="12" fill="#6b7280">(Dispatch Logic)</text>

        <!-- Process 7.2: Protocol Handler -->
        <rect x="650" y="350" width="220" height="120" rx="20" fill="#dcfce7" stroke="#10b981" stroke-width="2.5" filter="url(#shadow)"/>
        <text x="760" y="385" text-anchor="middle" font-size="13" font-weight="bold" fill="#059669">7.2</text>
        <line x1="675" y1="400" x2="845" y2="400" stroke="#10b981" stroke-width="2"/>
        <text x="760" y="425" text-anchor="middle" font-size="15" font-weight="600" fill="#1f2937">Protocol Handler</text>
        <text x="760" y="445" text-anchor="middle" font-size="12" fill="#6b7280">(MessagePack/bincode)</text>

        <!-- Process 7.3: Transport Manager -->
        <rect x="950" y="350" width="220" height="120" rx="20" fill="#dcfce7" stroke="#10b981" stroke-width="2.5" filter="url(#shadow)"/>
        <text x="1060" y="385" text-anchor="middle" font-size="13" font-weight="bold" fill="#059669">7.3</text>
        <line x1="975" y1="400" x2="1145" y2="400" stroke="#10b981" stroke-width="2"/>
        <text x="1060" y="425" text-anchor="middle" font-size="15" font-weight="600" fill="#1f2937">Transport Manager</text>
        <text x="1060" y="445" text-anchor="middle" font-size="12" fill="#6b7280">(Sockets/Pipes)</text>

        <!-- Process 7.4: Security Validator -->
        <rect x="500" y="550" width="220" height="120" rx="20" fill="#dcfce7" stroke="#10b981" stroke-width="2.5" filter="url(#shadow)"/>
        <text x="610" y="585" text-anchor="middle" font-size="13" font-weight="bold" fill="#059669">7.4</text>
        <line x1="525" y1="600" x2="695" y2="600" stroke="#10b981" stroke-width="2"/>
        <text x="610" y="630" text-anchor="middle" font-size="15" font-weight="600" fill="#1f2937">Security Validator</text>
        <text x="610" y="650" text-anchor="middle" font-size="12" fill="#6b7280">(Auth & Rate Limit)</text>

        <!-- ============================================ -->
        <!-- DATA STORES (None for Process 7.0) -->
        <!-- ============================================ -->

        <!-- No data stores for Process 7.0 - it's a pass-through communication layer -->

        <!-- ============================================ -->
        <!-- DATA FLOWS (Level-2 Internal Flows) -->
        <!-- ============================================ -->

        <!-- Process 6.0 to Process 7.1 (Message Router) -->
        <path d="M 230 195 L 300 195 L 300 410 L 350 410" stroke="#1f2937" stroke-width="2.5" fill="none" marker-end="url(#arrowhead)"/>
        <rect x="250" y="187" width="70" height="16" fill="white" opacity="0.95"/>
        <text x="285" y="198" text-anchor="middle" font-size="12" fill="#1f2937">IPC message</text>

        <!-- Process 7.1 to Process 7.4 -->
        <path d="M 460 470 L 460 520 L 610 520 L 610 550" stroke="#1f2937" stroke-width="2.5" fill="none" marker-end="url(#arrowhead)"/>
        <rect x="500" y="512" width="80" height="16" fill="white" opacity="0.95"/>
        <text x="540" y="523" text-anchor="middle" font-size="12" fill="#1f2937">Validate msg</text>

        <!-- Process 7.4 to Process 7.2 -->
        <path d="M 720 610 L 760 610 L 760 470" stroke="#1f2937" stroke-width="2.5" fill="none" marker-end="url(#arrowhead)"/>
        <rect x="720" y="512" width="80" height="16" fill="white" opacity="0.95"/>
        <text x="760" y="523" text-anchor="middle" font-size="12" fill="#1f2937">Auth OK</text>

        <!-- Process 7.2 to Process 7.3 -->
        <path d="M 870 410 L 910 410 L 910 410 L 950 410" stroke="#1f2937" stroke-width="2.5" fill="none" marker-end="url(#arrowhead)"/>
        <rect x="880" y="402" width="80" height="16" fill="white" opacity="0.95"/>
        <text x="920" y="413" text-anchor="middle" font-size="12" fill="#1f2937">Serialized msg</text>

        <!-- Process 7.3 to Process 8.0 -->
        <path d="M 1170 410 L 1300 410 L 1300 195 L 1370 195" stroke="#1f2937" stroke-width="2.5" fill="none" marker-end="url(#arrowhead)"/>
        <rect x="1210" y="402" width="80" height="16" fill="white" opacity="0.95"/>
        <text x="1250" y="413" text-anchor="middle" font-size="12" fill="#1f2937">Transport msg</text>

        <!-- Process 8.0 to Process 7.3 -->
        <path d="M 1370 205 L 1310 205 L 1310 420 L 1170 420" stroke="#1f2937" stroke-width="2.5" fill="none" marker-end="url(#arrowhead)"/>
        <rect x="1220" y="412" width="80" height="16" fill="white" opacity="0.95"/>
        <text x="1260" y="423" text-anchor="middle" font-size="12" fill="#1f2937">Response msg</text>

        <!-- Process 7.3 to Process 7.2 -->
        <path d="M 1060 470 L 1060 500 L 760 500 L 760 470" stroke="#1f2937" stroke-width="2.5" fill="none" marker-end="url(#arrowhead)"/>
        <rect x="880" y="492" width="80" height="16" fill="white" opacity="0.95"/>
        <text x="920" y="503" text-anchor="middle" font-size="12" fill="#1f2937">Raw response</text>

        <!-- Process 7.2 to Process 7.1 -->
        <path d="M 650 410 L 610 410 L 610 410 L 570 410" stroke="#1f2937" stroke-width="2.5" fill="none" marker-end="url(#arrowhead)"/>
        <rect x="580" y="402" width="80" height="16" fill="white" opacity="0.95"/>
        <text x="620" y="413" text-anchor="middle" font-size="12" fill="#1f2937">Parsed msg</text>

        <!-- Process 7.1 to Process 6.0 -->
        <path d="M 350 410 L 300 410 L 300 205 L 230 205" stroke="#1f2937" stroke-width="2.5" fill="none" marker-end="url(#arrowhead)"/>
        <rect x="250" y="197" width="70" height="16" fill="white" opacity="0.95"/>
        <text x="285" y="208" text-anchor="middle" font-size="12" fill="#1f2937">Route reply</text>



      </svg>
    </div>
  </div>

  <script>
    function saveToPNG() {
      const diagramWrapper = document.querySelector('.diagram-wrapper');
      html2canvas(diagramWrapper, {
        backgroundColor: '#ffffff',
        scale: 2,
        useCORS: true,
        allowTaint: true,
        logging: false
      }).then(canvas => {
        const link = document.createElement('a');
        link.download = 'symphony-dfd-level1.png';
        link.href = canvas.toDataURL('image/png');
        link.click();
      }).catch(err => {
        console.error('Error generating PNG:', err);
        alert('Failed to generate PNG. Please try again.');
      });
    }

    function saveToPDF() {
      window.print();
    }
  </script>
</body>
</html>
