<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Symphony IDE - Data Flow Diagram (Level-1)</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }
    
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
      background: #f5f5f5;
      padding: 2rem;
      overflow: auto;
    }
    
    .container {
      width: 100%;
      max-width: 100%;
      background: white;
      border-radius: 12px;
      box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
      padding: 2rem;
    }
    
    .header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 2rem;
      padding-bottom: 1rem;
      border-bottom: 2px solid #e5e7eb;
    }
    
    h1 {
      font-size: 1.75rem;
      font-weight: bold;
      color: #111827;
    }
    
    .buttons {
      display: flex;
      gap: 0.75rem;
    }
    
    button {
      padding: 0.625rem 1.25rem;
      background: linear-gradient(135deg, #333333 0%, #1a1a1a 100%);
      color: white;
      border: none;
      border-radius: 0.5rem;
      cursor: pointer;
      font-size: 0.875rem;
      font-weight: 600;
      transition: all 0.2s;
      box-shadow: 0 2px 4px rgba(0, 0, 0, 0.3);
    }
    
    button:hover {
      background: linear-gradient(135deg, #1a1a1a 0%, #000000 100%);
      transform: translateY(-1px);
      box-shadow: 0 4px 8px rgba(0, 0, 0, 0.4);
    }
    
    .diagram-wrapper {
      background: white;
      border-radius: 8px;
      border: 2px solid #d1d5db;
      padding: 1rem;
      overflow-x: auto;
    }
    
    svg {
      width: 100%;
      height: auto;
      min-width: 100%;
      border: 1px solid #e5e7eb;
      border-radius: 4px;
    }

    .legend {
      margin-top: 1.5rem;
      padding: 1rem;
      background: #f9fafb;
      border-radius: 8px;
      border: 1px solid #e5e7eb;
    }

    .legend h3 {
      font-size: 1rem;
      font-weight: 600;
      color: #1f2937;
      margin-bottom: 0.75rem;
    }

    .legend-items {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
      gap: 0.75rem;
    }

    .legend-item {
      display: flex;
      align-items: center;
      gap: 0.5rem;
      font-size: 0.875rem;
      color: #6b7280;
    }

    .legend-shape {
      width: 40px;
      height: 24px;
      border: 2px solid #4a90e2;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 0.7rem;
      color: #1f2937;
    }

    .legend-shape.process {
      border-radius: 12px;
      background: #e0f2fe;
    }

    .legend-shape.entity {
      border-radius: 2px;
      background: #f3f4f6;
    }

    .legend-shape.datastore {
      border-left: none;
      background: white;
    }
  </style>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
</head>
<body>
  <div class="container">
    <div class="header">
      <h1>Symphony IDE - Complete System Data Flow Diagram (Level-1)</h1>
      <div class="buttons">
        <button onclick="saveToPNG()">ðŸ’¾ Save as PNG</button>
        <button onclick="saveToPDF()">ðŸ“„ Save as PDF</button>
      </div>
    </div>
    
    <div class="diagram-wrapper">
      <svg id="diagram" viewBox="0 0 1800 1400" xmlns="http://www.w3.org/2000/svg">
        <defs>
          <!-- Arrow marker for data flows -->
          <marker id="arrowhead" markerWidth="10" markerHeight="10" refX="9" refY="3" orient="auto">
            <polygon points="0 0, 10 3, 0 6" fill="#1f2937" />
          </marker>

          <!-- Shadow filter -->
          <filter id="shadow" x="-50%" y="-50%" width="200%" height="200%">
            <feGaussianBlur in="SourceAlpha" stdDeviation="2"/>
            <feOffset dx="2" dy="2" result="offsetblur"/>
            <feComponentTransfer>
              <feFuncA type="linear" slope="0.15"/>
            </feComponentTransfer>
            <feMerge>
              <feMergeNode/>
              <feMergeNode in="SourceGraphic"/>
            </feMerge>
          </filter>
        </defs>

        <!-- Title -->
        <text x="900" y="30" text-anchor="middle" font-size="18" font-weight="bold" fill="#1f2937">
          Symphony IDE - Complete System Architecture (DFD Level-1)
        </text>

        <!-- ============================================ -->
        <!-- EXTERNAL ENTITIES (Rectangles) -->
        <!-- ============================================ -->
        
        <!-- Developer (External Entity) -->
        <rect x="50" y="120" width="160" height="80" rx="4" fill="#f3f4f6" stroke="#6b7280" stroke-width="2" filter="url(#shadow)"/>
        <text x="130" y="165" text-anchor="middle" font-size="14" font-weight="600" fill="#1f2937">Developer</text>

        <!-- AI Model Provider (External Entity) -->
        <rect x="1590" y="120" width="160" height="80" rx="4" fill="#f3f4f6" stroke="#6b7280" stroke-width="2" filter="url(#shadow)"/>
        <text x="1670" y="155" text-anchor="middle" font-size="14" font-weight="600" fill="#1f2937">AI Model</text>
        <text x="1670" y="175" text-anchor="middle" font-size="14" font-weight="600" fill="#1f2937">Provider</text>

        <!-- Extension Marketplace (External Entity) -->
        <rect x="1590" y="600" width="160" height="80" rx="4" fill="#f3f4f6" stroke="#6b7280" stroke-width="2" filter="url(#shadow)"/>
        <text x="1670" y="630" text-anchor="middle" font-size="14" font-weight="600" fill="#1f2937">Extension</text>
        <text x="1670" y="650" text-anchor="middle" font-size="14" font-weight="600" fill="#1f2937">Marketplace</text>

        <!-- ============================================ -->
        <!-- PROCESSES (Rounded Rectangles with Numbers) -->
        <!-- ============================================ -->

        <!-- Process 1.0: User Interface Layer -->
        <rect x="280" y="100" width="200" height="110" rx="20" fill="#e0f2fe" stroke="#4a90e2" stroke-width="2" filter="url(#shadow)"/>
        <text x="380" y="130" text-anchor="middle" font-size="12" font-weight="bold" fill="#0284c7">1.0</text>
        <line x1="300" y1="142" x2="460" y2="142" stroke="#4a90e2" stroke-width="1.5"/>
        <text x="380" y="168" text-anchor="middle" font-size="14" font-weight="500" fill="#1f2937">User Interface</text>
        <text x="380" y="188" text-anchor="middle" font-size="11" fill="#6b7280">(React + Tauri)</text>

        <!-- Process 2.0: Core Engine -->
        <rect x="580" y="100" width="200" height="110" rx="20" fill="#e0f2fe" stroke="#4a90e2" stroke-width="2" filter="url(#shadow)"/>
        <text x="680" y="130" text-anchor="middle" font-size="12" font-weight="bold" fill="#0284c7">2.0</text>
        <line x1="600" y1="142" x2="760" y2="142" stroke="#4a90e2" stroke-width="1.5"/>
        <text x="680" y="168" text-anchor="middle" font-size="14" font-weight="500" fill="#1f2937">Core Engine</text>
        <text x="680" y="188" text-anchor="middle" font-size="11" fill="#6b7280">(JSON-RPC Server)</text>

        <!-- Process 3.0: Extension Manager -->
        <rect x="880" y="100" width="200" height="110" rx="20" fill="#e0f2fe" stroke="#4a90e2" stroke-width="2" filter="url(#shadow)"/>
        <text x="980" y="130" text-anchor="middle" font-size="12" font-weight="bold" fill="#0284c7">3.0</text>
        <line x1="900" y1="142" x2="1060" y2="142" stroke="#4a90e2" stroke-width="1.5"/>
        <text x="980" y="168" text-anchor="middle" font-size="14" font-weight="500" fill="#1f2937">Extension Manager</text>
        <text x="980" y="188" text-anchor="middle" font-size="11" fill="#6b7280">(Orchestra Kit)</text>

        <!-- Process 4.0: AI Orchestration -->
        <rect x="1180" y="100" width="200" height="110" rx="20" fill="#fef3c7" stroke="#f59e0b" stroke-width="2" filter="url(#shadow)"/>
        <text x="1280" y="130" text-anchor="middle" font-size="12" font-weight="bold" fill="#d97706">4.0</text>
        <line x1="1200" y1="142" x2="1360" y2="142" stroke="#f59e0b" stroke-width="1.5"/>
        <text x="1280" y="168" text-anchor="middle" font-size="14" font-weight="500" fill="#1f2937">AI Orchestration</text>
        <text x="1280" y="188" text-anchor="middle" font-size="11" fill="#6b7280">(Conductor + Pool)</text>

        <!-- Process 5.0: Workflow Engine -->
        <rect x="280" y="500" width="200" height="110" rx="20" fill="#fef3c7" stroke="#f59e0b" stroke-width="2" filter="url(#shadow)"/>
        <text x="380" y="530" text-anchor="middle" font-size="12" font-weight="bold" fill="#d97706">5.0</text>
        <line x1="300" y1="542" x2="460" y2="542" stroke="#f59e0b" stroke-width="1.5"/>
        <text x="380" y="568" text-anchor="middle" font-size="14" font-weight="500" fill="#1f2937">Workflow Engine</text>
        <text x="380" y="588" text-anchor="middle" font-size="11" fill="#6b7280">(DAG Tracker)</text>

        <!-- Process 6.0: File Operations -->
        <rect x="580" y="500" width="200" height="110" rx="20" fill="#fef3c7" stroke="#f59e0b" stroke-width="2" filter="url(#shadow)"/>
        <text x="680" y="530" text-anchor="middle" font-size="12" font-weight="bold" fill="#d97706">6.0</text>
        <line x1="600" y1="542" x2="760" y2="542" stroke="#f59e0b" stroke-width="1.5"/>
        <text x="680" y="568" text-anchor="middle" font-size="14" font-weight="500" fill="#1f2937">File Operations</text>
        <text x="680" y="588" text-anchor="middle" font-size="11" fill="#6b7280">(IDE Layer)</text>

        <!-- Process 7.0: IPC Communication -->
        <rect x="880" y="500" width="200" height="110" rx="20" fill="#dcfce7" stroke="#10b981" stroke-width="2" filter="url(#shadow)"/>
        <text x="980" y="530" text-anchor="middle" font-size="12" font-weight="bold" fill="#059669">7.0</text>
        <line x1="900" y1="542" x2="1060" y2="542" stroke="#10b981" stroke-width="1.5"/>
        <text x="980" y="568" text-anchor="middle" font-size="14" font-weight="500" fill="#1f2937">IPC Communication</text>
        <text x="980" y="588" text-anchor="middle" font-size="11" fill="#6b7280">(Message Bus)</text>

        <!-- Process 8.0: Extension Execution -->
        <rect x="1180" y="500" width="200" height="110" rx="20" fill="#dcfce7" stroke="#10b981" stroke-width="2" filter="url(#shadow)"/>
        <text x="1280" y="530" text-anchor="middle" font-size="12" font-weight="bold" fill="#059669">8.0</text>
        <line x1="1200" y1="542" x2="1360" y2="542" stroke="#10b981" stroke-width="1.5"/>
        <text x="1280" y="568" text-anchor="middle" font-size="14" font-weight="500" fill="#1f2937">Extension Execution</text>
        <text x="1280" y="588" text-anchor="middle" font-size="11" fill="#6b7280">(The Pit)</text>

        <!-- Process 9.0: Artifact Management -->
        <rect x="280" y="900" width="200" height="110" rx="20" fill="#e0f2fe" stroke="#4a90e2" stroke-width="2" filter="url(#shadow)"/>
        <text x="380" y="930" text-anchor="middle" font-size="12" font-weight="bold" fill="#0284c7">9.0</text>
        <line x1="300" y1="942" x2="460" y2="942" stroke="#4a90e2" stroke-width="1.5"/>
        <text x="380" y="968" text-anchor="middle" font-size="14" font-weight="500" fill="#1f2937">Artifact Management</text>
        <text x="380" y="988" text-anchor="middle" font-size="11" fill="#6b7280">(Artifact Store)</text>

        <!-- Process 10.0: Configuration -->
        <rect x="580" y="900" width="200" height="110" rx="20" fill="#e0f2fe" stroke="#4a90e2" stroke-width="2" filter="url(#shadow)"/>
        <text x="680" y="930" text-anchor="middle" font-size="12" font-weight="bold" fill="#0284c7">10.0</text>
        <line x1="600" y1="942" x2="760" y2="942" stroke="#4a90e2" stroke-width="1.5"/>
        <text x="680" y="968" text-anchor="middle" font-size="14" font-weight="500" fill="#1f2937">Configuration</text>
        <text x="680" y="988" text-anchor="middle" font-size="11" fill="#6b7280">(Config Manager)</text>

        <!-- Process 11.0: Security & Permissions -->
        <rect x="880" y="900" width="200" height="110" rx="20" fill="#dcfce7" stroke="#10b981" stroke-width="2" filter="url(#shadow)"/>
        <text x="980" y="930" text-anchor="middle" font-size="12" font-weight="bold" fill="#059669">11.0</text>
        <line x1="900" y1="942" x2="1060" y2="942" stroke="#10b981" stroke-width="1.5"/>
        <text x="980" y="968" text-anchor="middle" font-size="14" font-weight="500" fill="#1f2937">Security</text>
        <text x="980" y="988" text-anchor="middle" font-size="11" fill="#6b7280">(RBAC + Sandbox)</text>

        <!-- Process 12.0: Extension Marketplace -->
        <rect x="1180" y="900" width="200" height="110" rx="20" fill="#fef3c7" stroke="#f59e0b" stroke-width="2" filter="url(#shadow)"/>
        <text x="1280" y="930" text-anchor="middle" font-size="12" font-weight="bold" fill="#d97706">12.0</text>
        <line x1="1200" y1="942" x2="1360" y2="942" stroke="#f59e0b" stroke-width="1.5"/>
        <text x="1280" y="968" text-anchor="middle" font-size="14" font-weight="500" fill="#1f2937">Marketplace Sync</text>
        <text x="1280" y="988" text-anchor="middle" font-size="11" fill="#6b7280">(Discovery)</text>

        <!-- ============================================ -->
        <!-- DATA STORES (Open-ended Rectangles) -->
        <!-- ============================================ -->

        <!-- D1: Project Files -->
        <rect x="50" y="1300" width="200" height="70" fill="#ffffff" stroke="#4a90e2" stroke-width="2" filter="url(#shadow)"/>
        <line x1="50" y1="1300" x2="50" y2="1370" stroke="#ffffff" stroke-width="4"/>
        <line x1="90" y1="1300" x2="90" y2="1370" stroke="#4a90e2" stroke-width="1.5"/>
        <text x="70" y="1340" text-anchor="middle" font-size="12" font-weight="bold" fill="#0284c7">D1</text>
        <text x="150" y="1340" text-anchor="middle" font-size="13" font-weight="500" fill="#1f2937">Project Files</text>

        <!-- D2: Configuration Store -->
        <rect x="300" y="1300" width="200" height="70" fill="#ffffff" stroke="#4a90e2" stroke-width="2" filter="url(#shadow)"/>
        <line x1="300" y1="1300" x2="300" y2="1370" stroke="#ffffff" stroke-width="4"/>
        <line x1="340" y1="1300" x2="340" y2="1370" stroke="#4a90e2" stroke-width="1.5"/>
        <text x="320" y="1340" text-anchor="middle" font-size="12" font-weight="bold" fill="#0284c7">D2</text>
        <text x="400" y="1340" text-anchor="middle" font-size="13" font-weight="500" fill="#1f2937">Configuration Store</text>

        <!-- D3: Extension Registry -->
        <rect x="550" y="1300" width="200" height="70" fill="#ffffff" stroke="#4a90e2" stroke-width="2" filter="url(#shadow)"/>
        <line x1="550" y1="1300" x2="550" y2="1370" stroke="#ffffff" stroke-width="4"/>
        <line x1="590" y1="1300" x2="590" y2="1370" stroke="#4a90e2" stroke-width="1.5"/>
        <text x="570" y="1340" text-anchor="middle" font-size="12" font-weight="bold" fill="#0284c7">D3</text>
        <text x="650" y="1340" text-anchor="middle" font-size="13" font-weight="500" fill="#1f2937">Extension Registry</text>

        <!-- D4: Artifact Store -->
        <rect x="800" y="1300" width="200" height="70" fill="#ffffff" stroke="#4a90e2" stroke-width="2" filter="url(#shadow)"/>
        <line x1="800" y1="1300" x2="800" y2="1370" stroke="#ffffff" stroke-width="4"/>
        <line x1="840" y1="1300" x2="840" y2="1370" stroke="#4a90e2" stroke-width="1.5"/>
        <text x="820" y="1340" text-anchor="middle" font-size="12" font-weight="bold" fill="#0284c7">D4</text>
        <text x="900" y="1340" text-anchor="middle" font-size="13" font-weight="500" fill="#1f2937">Artifact Store</text>

        <!-- D5: Workflow State -->
        <rect x="1050" y="1300" width="200" height="70" fill="#ffffff" stroke="#4a90e2" stroke-width="2" filter="url(#shadow)"/>
        <line x1="1050" y1="1300" x2="1050" y2="1370" stroke="#ffffff" stroke-width="4"/>
        <line x1="1090" y1="1300" x2="1090" y2="1370" stroke="#4a90e2" stroke-width="1.5"/>
        <text x="1070" y="1340" text-anchor="middle" font-size="12" font-weight="bold" fill="#0284c7">D5</text>
        <text x="1150" y="1340" text-anchor="middle" font-size="13" font-weight="500" fill="#1f2937">Workflow State</text>

        <!-- D6: AI Model Cache -->
        <rect x="1300" y="1300" width="200" height="70" fill="#ffffff" stroke="#4a90e2" stroke-width="2" filter="url(#shadow)"/>
        <line x1="1300" y1="1300" x2="1300" y2="1370" stroke="#ffffff" stroke-width="4"/>
        <line x1="1340" y1="1300" x2="1340" y2="1370" stroke="#4a90e2" stroke-width="1.5"/>
        <text x="1320" y="1340" text-anchor="middle" font-size="12" font-weight="bold" fill="#0284c7">D6</text>
        <text x="1400" y="1340" text-anchor="middle" font-size="13" font-weight="500" fill="#1f2937">AI Model Cache</text>

        <!-- D7: Security Policies -->
        <rect x="1550" y="1300" width="200" height="70" fill="#ffffff" stroke="#4a90e2" stroke-width="2" filter="url(#shadow)"/>
        <line x1="1550" y1="1300" x2="1550" y2="1370" stroke="#ffffff" stroke-width="4"/>
        <line x1="1590" y1="1300" x2="1590" y2="1370" stroke="#4a90e2" stroke-width="1.5"/>
        <text x="1570" y="1340" text-anchor="middle" font-size="12" font-weight="bold" fill="#0284c7">D7</text>
        <text x="1650" y="1340" text-anchor="middle" font-size="13" font-weight="500" fill="#1f2937">Security Policies</text>

        <!-- ============================================ -->
        <!-- DATA FLOWS (Elbow Connectors with Labels) -->
        <!-- ============================================ -->

        <!-- Developer to Process 1.0 (UI) -->
        <path d="M 210 160 L 240 160 L 240 155 L 280 155" stroke="#1f2937" stroke-width="2" fill="none" marker-end="url(#arrowhead)"/>
        <rect x="215" y="147" width="60" height="16" fill="white" opacity="0.9"/>
        <text x="245" y="158" text-anchor="middle" font-size="11" fill="#6b7280">User input</text>

        <!-- Process 1.0 to Process 2.0 -->
        <path d="M 480 155 L 530 155 L 530 155 L 580 155" stroke="#1f2937" stroke-width="2" fill="none" marker-end="url(#arrowhead)"/>
        <rect x="505" y="147" width="70" height="16" fill="white" opacity="0.9"/>
        <text x="540" y="158" text-anchor="middle" font-size="11" fill="#6b7280">UI commands</text>

        <!-- Process 2.0 to Process 3.0 -->
        <path d="M 780 155 L 830 155 L 830 155 L 880 155" stroke="#1f2937" stroke-width="2" fill="none" marker-end="url(#arrowhead)"/>
        <rect x="800" y="147" width="60" height="16" fill="white" opacity="0.9"/>
        <text x="830" y="158" text-anchor="middle" font-size="11" fill="#6b7280">RPC calls</text>

        <!-- Process 3.0 to Process 4.0 -->
        <path d="M 1080 155 L 1130 155 L 1130 155 L 1180 155" stroke="#1f2937" stroke-width="2" fill="none" marker-end="url(#arrowhead)"/>
        <rect x="1095" y="147" width="70" height="16" fill="white" opacity="0.9"/>
        <text x="1130" y="158" text-anchor="middle" font-size="11" fill="#6b7280">Ext requests</text>

        <!-- Process 4.0 to AI Provider -->
        <path d="M 1380 155 L 1485 155 L 1485 160 L 1590 160" stroke="#1f2937" stroke-width="2" fill="none" marker-end="url(#arrowhead)"/>
        <rect x="1450" y="147" width="70" height="16" fill="white" opacity="0.9"/>
        <text x="1485" y="158" text-anchor="middle" font-size="11" fill="#6b7280">Model query</text>

        <!-- AI Provider to Process 4.0 -->
        <path d="M 1590 170 L 1485 170 L 1485 165 L 1380 165" stroke="#1f2937" stroke-width="2" fill="none" marker-end="url(#arrowhead)"/>
        <rect x="1450" y="162" width="70" height="16" fill="white" opacity="0.9"/>
        <text x="1485" y="173" text-anchor="middle" font-size="11" fill="#6b7280">AI response</text>

        <!-- Process 2.0 to Process 5.0 -->
        <path d="M 680 210 L 680 350 L 380 350 L 380 500" stroke="#1f2937" stroke-width="2" fill="none" marker-end="url(#arrowhead)"/>
        <rect x="350" y="342" width="60" height="16" fill="white" opacity="0.9"/>
        <text x="380" y="353" text-anchor="middle" font-size="11" fill="#6b7280">Workflow</text>

        <!-- Process 2.0 to Process 6.0 -->
        <path d="M 680 210 L 680 350 L 680 350 L 680 500" stroke="#1f2937" stroke-width="2" fill="none" marker-end="url(#arrowhead)"/>
        <rect x="650" y="342" width="60" height="16" fill="white" opacity="0.9"/>
        <text x="680" y="353" text-anchor="middle" font-size="11" fill="#6b7280">File ops</text>

        <!-- Process 3.0 to Process 8.0 -->
        <path d="M 980 210 L 980 350 L 1280 350 L 1280 500" stroke="#1f2937" stroke-width="2" fill="none" marker-end="url(#arrowhead)"/>
        <rect x="1100" y="342" width="80" height="16" fill="white" opacity="0.9"/>
        <text x="1140" y="353" text-anchor="middle" font-size="11" fill="#6b7280">Ext execution</text>

        <!-- Process 7.0 (IPC) connections -->
        <path d="M 880 555 L 830 555 L 830 555 L 780 555" stroke="#1f2937" stroke-width="2" fill="none" marker-end="url(#arrowhead)"/>
        <rect x="800" y="547" width="60" height="16" fill="white" opacity="0.9"/>
        <text x="830" y="558" text-anchor="middle" font-size="11" fill="#6b7280">Messages</text>

        <!-- Process 6.0 to D1 (Project Files) -->
        <path d="M 680 610 L 680 680 L 230 680 L 230 1150 L 150 1150 L 150 1300" stroke="#1f2937" stroke-width="2" fill="none" marker-end="url(#arrowhead)"/>
        <rect x="120" y="1142" width="60" height="16" fill="white" opacity="0.9"/>
        <text x="150" y="1153" text-anchor="middle" font-size="11" fill="#6b7280">File data</text>

        <!-- D1 to Process 6.0 -->
        <path d="M 160 1300 L 160 1160 L 260 1160 L 260 690 L 670 690 L 670 610" stroke="#1f2937" stroke-width="2" fill="none" marker-end="url(#arrowhead)"/>
        <rect x="640" y="1152" width="60" height="16" fill="white" opacity="0.9"/>
        <text x="670" y="1163" text-anchor="middle" font-size="11" fill="#6b7280">Read files</text>

        <!-- Process 10.0 to D2 (Config) -->
        <path d="M 680 1010 L 680 1100 L 450 1100 L 450 1170 L 400 1170 L 400 1300" stroke="#1f2937" stroke-width="2" fill="none" marker-end="url(#arrowhead)"/>
        <rect x="370" y="1162" width="60" height="16" fill="white" opacity="0.9"/>
        <text x="400" y="1173" text-anchor="middle" font-size="11" fill="#6b7280">Config data</text>

        <!-- D2 to Process 10.0 -->
        <path d="M 410 1300 L 410 1180 L 460 1180 L 460 1110 L 670 1110 L 670 1010" stroke="#1f2937" stroke-width="2" fill="none" marker-end="url(#arrowhead)"/>
        <rect x="640" y="1172" width="70" height="16" fill="white" opacity="0.9"/>
        <text x="675" y="1183" text-anchor="middle" font-size="11" fill="#6b7280">Load config</text>

        <!-- Process 3.0 to D3 (Extension Registry) -->
        <path d="M 980 210 L 980 290 L 1130 290 L 1130 1190 L 650 1190 L 650 1300" stroke="#1f2937" stroke-width="2" fill="none" marker-end="url(#arrowhead)"/>
        <rect x="790" y="1182" width="80" height="16" fill="white" opacity="0.9"/>
        <text x="830" y="1193" text-anchor="middle" font-size="11" fill="#6b7280">Register ext</text>

        <!-- D3 to Process 8.0 -->
        <path d="M 660 1300 L 660 1200 L 1230 1200 L 1230 790 L 1430 790 L 1430 555 L 1380 555" stroke="#1f2937" stroke-width="2" fill="none" marker-end="url(#arrowhead)"/>
        <rect x="950" y="1192" width="70" height="16" fill="white" opacity="0.9"/>
        <text x="985" y="1203" text-anchor="middle" font-size="11" fill="#6b7280">Ext lookup</text>

        <!-- Process 9.0 to D4 (Artifacts) -->
        <path d="M 480 955 L 900 955 L 900 1300" stroke="#1f2937" stroke-width="2" fill="none" marker-end="url(#arrowhead)"/>
        <rect x="680" y="947" width="60" height="16" fill="white" opacity="0.9"/>
        <text x="710" y="958" text-anchor="middle" font-size="11" fill="#6b7280">Store art</text>

        <!-- D4 to Process 9.0 -->
        <path d="M 890 1300 L 890 1210 L 260 1210 L 260 1100 L 320 1100 L 320 1010 L 380 1010" stroke="#1f2937" stroke-width="2" fill="none" marker-end="url(#arrowhead)"/>
        <rect x="620" y="1202" width="60" height="16" fill="white" opacity="0.9"/>
        <text x="650" y="1213" text-anchor="middle" font-size="11" fill="#6b7280">Get art</text>

        <!-- Process 5.0 to D5 (Workflow State) -->
        <path d="M 480 555 L 530 555 L 530 770 L 1120 770 L 1120 1220 L 1150 1220 L 1150 1300" stroke="#1f2937" stroke-width="2" fill="none" marker-end="url(#arrowhead)"/>
        <rect x="780" y="1212" width="80" height="16" fill="white" opacity="0.9"/>
        <text x="820" y="1223" text-anchor="middle" font-size="11" fill="#6b7280">Save state</text>

        <!-- D5 to Process 5.0 -->
        <path d="M 1140 1300 L 1140 1230 L 1110 1230 L 1110 780 L 520 780 L 520 565 L 480 565" stroke="#1f2937" stroke-width="2" fill="none" marker-end="url(#arrowhead)"/>
        <rect x="780" y="1222" width="80" height="16" fill="white" opacity="0.9"/>
        <text x="820" y="1233" text-anchor="middle" font-size="11" fill="#6b7280">Load state</text>

        <!-- Process 4.0 to D6 (AI Cache) -->
        <path d="M 1280 210 L 1280 270 L 1440 270 L 1440 1240 L 1400 1240 L 1400 1300" stroke="#1f2937" stroke-width="2" fill="none" marker-end="url(#arrowhead)"/>
        <rect x="1290" y="700" width="80" height="16" fill="white" opacity="0.9"/>
        <text x="1330" y="711" text-anchor="middle" font-size="11" fill="#6b7280">Cache model</text>

        <!-- D6 to Process 4.0 -->
        <path d="M 1390 1300 L 1390 1250 L 1210 1250 L 1210 260 L 1270 260 L 1270 210" stroke="#1f2937" stroke-width="2" fill="none" marker-end="url(#arrowhead)"/>
        <rect x="1280" y="720" width="80" height="16" fill="white" opacity="0.9"/>
        <text x="1320" y="731" text-anchor="middle" font-size="11" fill="#6b7280">Load cache</text>

        <!-- Process 11.0 to D7 (Security) -->
        <path d="M 1080 955 L 1650 955 L 1650 1300" stroke="#1f2937" stroke-width="2" fill="none" marker-end="url(#arrowhead)"/>
        <rect x="1360" y="947" width="80" height="16" fill="white" opacity="0.9"/>
        <text x="1400" y="958" text-anchor="middle" font-size="11" fill="#6b7280">Policy rules</text>

        <!-- D7 to Process 11.0 -->
        <path d="M 1640 1300 L 1640 1260 L 1120 1260 L 1120 1100 L 1030 1100 L 1030 1010 L 980 1010" stroke="#1f2937" stroke-width="2" fill="none" marker-end="url(#arrowhead)"/>
        <rect x="1290" y="1252" width="80" height="16" fill="white" opacity="0.9"/>
        <text x="1330" y="1263" text-anchor="middle" font-size="11" fill="#6b7280">Check perms</text>

        <!-- Process 12.0 to Marketplace -->
        <path d="M 1380 955 L 1450 955 L 1450 800 L 1540 800 L 1540 640 L 1590 640" stroke="#1f2937" stroke-width="2" fill="none" marker-end="url(#arrowhead)"/>
        <rect x="1450" y="947" width="70" height="16" fill="white" opacity="0.9"/>
        <text x="1485" y="958" text-anchor="middle" font-size="11" fill="#6b7280">Sync ext</text>

        <!-- Marketplace to Process 12.0 -->
        <path d="M 1590 650 L 1550 650 L 1550 810 L 1460 810 L 1460 1070 L 1340 1070 L 1340 1010 L 1280 1010" stroke="#1f2937" stroke-width="2" fill="none" marker-end="url(#arrowhead)"/>
        <rect x="1450" y="957" width="70" height="16" fill="white" opacity="0.9"/>
        <text x="1485" y="968" text-anchor="middle" font-size="11" fill="#6b7280">Ext catalog</text>

        <!-- Process 1.0 to Developer (Output) -->
        <path d="M 280 165 L 240 165 L 240 170 L 210 170" stroke="#1f2937" stroke-width="2" fill="none" marker-end="url(#arrowhead)"/>
        <rect x="215" y="162" width="60" height="16" fill="white" opacity="0.9"/>
        <text x="245" y="173" text-anchor="middle" font-size="11" fill="#6b7280">UI output</text>


      </svg>
    </div>
  </div>

  <script>
    function saveToPNG() {
      const diagramWrapper = document.querySelector('.diagram-wrapper');
      html2canvas(diagramWrapper, {
        backgroundColor: '#ffffff',
        scale: 2,
        useCORS: true,
        allowTaint: true,
        logging: false
      }).then(canvas => {
        const link = document.createElement('a');
        link.download = 'symphony-dfd-level1.png';
        link.href = canvas.toDataURL('image/png');
        link.click();
      }).catch(err => {
        console.error('Error generating PNG:', err);
        alert('Failed to generate PNG. Please try again.');
      });
    }

    function saveToPDF() {
      window.print();
    }
  </script>
</body>
</html>
